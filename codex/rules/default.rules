# Codex local execpolicy baseline.
# Strategy: allow common day-to-day tooling, keep shells explicit, and hard-block dangerous prefixes.

# Broad allowlist for routine workflows.
prefix_rule(pattern=["git"], decision="allow")
prefix_rule(pattern=["gh"], decision="allow")
prefix_rule(pattern=["npm"], decision="allow")
prefix_rule(pattern=["npx"], decision="allow")
prefix_rule(pattern=["jq"], decision="allow")
prefix_rule(pattern=["curl"], decision="allow")
prefix_rule(pattern=["docker"], decision="allow")
prefix_rule(pattern=["docker-compose"], decision="allow")
prefix_rule(pattern=["railway"], decision="allow")
prefix_rule(pattern=["sqlite3"], decision="allow")
prefix_rule(pattern=["codex"], decision="allow")

# Do not blanket-allow shells. Keep explicit prompts for shell interpreters.
prefix_rule(pattern=["bash"], decision="prompt")
prefix_rule(pattern=["sh"], decision="prompt")
prefix_rule(pattern=["zsh"], decision="prompt")
prefix_rule(pattern=["/bin/bash"], decision="prompt")
prefix_rule(pattern=["/bin/sh"], decision="prompt")
prefix_rule(pattern=["/bin/zsh"], decision="prompt")
prefix_rule(pattern=["/opt/homebrew/bin/zsh"], decision="prompt")

# Hard blocks: destructive filesystem actions.
prefix_rule(pattern=["rm", "-rf"], decision="forbidden")
prefix_rule(pattern=["sudo", "rm", "-rf"], decision="forbidden")

# Hard blocks: dangerous git history rewrite patterns.
prefix_rule(pattern=["git", "reset", "--hard"], decision="forbidden")
prefix_rule(pattern=["git", "push", "--force"], decision="forbidden")
prefix_rule(pattern=["git", "push", "-f"], decision="forbidden")
prefix_rule(pattern=["git", "push", "--force-with-lease"], decision="forbidden")
prefix_rule(pattern=["git", "push", "origin", "--force"], decision="forbidden")
prefix_rule(pattern=["git", "push", "origin", "-f"], decision="forbidden")
prefix_rule(pattern=["git", "push", "origin", "--force-with-lease"], decision="forbidden")
prefix_rule(pattern=["git", "push", "-u", "origin", "--force"], decision="forbidden")
prefix_rule(pattern=["git", "push", "-u", "origin", "-f"], decision="forbidden")
prefix_rule(pattern=["git", "push", "-u", "origin", "--force-with-lease"], decision="forbidden")
prefix_rule(pattern=["gh", "pr", "list"], decision="allow")
prefix_rule(pattern=["gh", "pr", "status"], decision="allow")
prefix_rule(pattern=["/opt/homebrew/bin/zsh", "-lc", "WT=/tmp/toast-pr1110-$(date +%s); git -C /Users/restuta/Projects/toast/backend fetch origin codex/non-cache-webhook-ingress-filter && git -C /Users/restuta/Projects/toast/backend worktree add \"$WT\" FETCH_HEAD && echo \"$WT\""], decision="allow")
prefix_rule(pattern=["git", "-C", "/tmp/toast-pr1110-1771488999", "add", "src/lib/github/github-webhooks-primary-allowlist.js"], decision="allow")
prefix_rule(pattern=["git", "-C", "/tmp/toast-pr1110-1771488999", "push", "origin"], decision="allow")
prefix_rule(pattern=["git", "-C", "/private/tmp/toast-pr1103-work", "add", "src/proc/to-process-jobs/job-processors/github-webhooks-cache/_test/app-home-debounce.test.js"], decision="allow")
prefix_rule(pattern=["git", "-C", "/private/tmp/toast-pr1103-work", "add", "src/lib/redis/commands/try-acquire-app-home-cooldown.js"], decision="allow")
prefix_rule(pattern=["node", "dist/src/scripts/telegram-runtime-readiness.js"], decision="allow")
